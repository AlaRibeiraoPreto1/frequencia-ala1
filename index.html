<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Frequência Sacramental</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Babel Standalone para compilar JSX no navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f1f5f9; }
        /* Custom scrollbar hiding */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animações simples */
        .animate-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
    
    <!-- Import Map para carregar bibliotecas via ESM -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "recharts": "https://esm.sh/recharts@2.12.0?external=react,react-dom",
    "lucide-react": "https://esm.sh/lucide-react@0.330.0?external=react",
    "react-dom/": "https://esm.sh/react-dom@^19.2.4/",
    "react/": "https://esm.sh/react@^19.2.4/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <!-- Script Principal com Lógica React -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import ReactDOM from 'react-dom/client';
        import { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer, LineChart, Line } from 'recharts';
        import { 
            Search, SlidersHorizontal, Check, UserPlus, UserMinus, 
            LayoutDashboard, ClipboardList, HeartHandshake, FileText, 
            PlusCircle, Menu, LogOut, Church 
        } from 'lucide-react';

        // --- MOCK DATA (Simulando banco de dados) ---
        const MOCK_MEMBERS = [
            { id: '1', name: 'JOSE SILVA', familia: 'SILVA', org: 'Quórum de Élderes', categoria: 'Membro', telefone: '1199999999', isHead: true, lastAttended: '2024-01-01' },
            { id: '2', name: 'MARIA SILVA', familia: 'SILVA', org: 'Sociedade de Socorro', categoria: 'Membro', telefone: '1199999999', isHead: false, lastAttended: '2024-01-01' },
            { id: '3', name: 'JOAO SOUZA', familia: 'SOUZA', org: 'Rapazes', categoria: 'Membro', telefone: '', isHead: true, lastAttended: '2023-12-01' },
            { id: '4', name: 'ANA SOUZA', familia: 'SOUZA', org: 'Moças', categoria: 'Membro', telefone: '', isHead: false, lastAttended: '2024-01-01' },
            { id: '5', name: 'PEDRO SANTOS', familia: 'SANTOS', org: 'Primária', categoria: 'Membro', telefone: '', isHead: true, lastAttended: '2023-10-01' },
        ];

        const MOCK_USERS = [
            { id: '1', username: 'admin', name: 'Bispo Ala', role: 'admin', password: '123' },
            { id: '2', username: 'sec', name: 'Secretário', role: 'user', password: '123' },
        ];

        // --- COMPONENTES ---

        // 1. Componente de Login
        const Login = ({ onLogin }) => {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const [isFirstAccess, setIsFirstAccess] = useState(false);
            const [error, setError] = useState('');

            const handleLogin = () => {
                const user = MOCK_USERS.find(u => u.username === username && u.password === password);
                if (user) onLogin(user);
                else setError('Usuário ou senha incorretos.');
            };

            return (
                <div className="min-h-screen flex items-center justify-center bg-slate-50 p-6">
                    <div className="bg-white/80 backdrop-blur-md border border-white/20 p-10 w-full max-w-sm text-center space-y-8 shadow-2xl rounded-[28px]">
                        <div className="flex justify-center mb-4">
                             <div className="w-16 h-16 bg-[#002e5d] rounded-2xl flex items-center justify-center text-white shadow-lg">
                                <Church size={32} />
                             </div>
                        </div>
                        <h2 className="text-2xl font-black text-slate-800 tracking-tighter uppercase italic leading-tight">
                            Ala <br />Ribeirão Preto 1
                        </h2>

                        {!isFirstAccess ? (
                            <div className="space-y-3">
                                <input 
                                    type="text" 
                                    placeholder="Usuário" 
                                    value={username}
                                    onChange={(e) => setUsername(e.target.value.toLowerCase())}
                                    className="w-full p-4 rounded-2xl bg-slate-100 border-none outline-none text-sm font-bold focus:ring-2 focus:ring-[#002e5d]"
                                />
                                <input 
                                    type="password" 
                                    placeholder="Senha" 
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full p-4 rounded-2xl bg-slate-100 border-none outline-none text-sm focus:ring-2 focus:ring-[#002e5d]"
                                />
                                {error && <p className="text-xs text-red-500 font-bold">{error}</p>}
                                <button 
                                    onClick={handleLogin} 
                                    className="w-full bg-[#002e5d] text-white py-4 rounded-2xl font-bold shadow-xl active:scale-95 uppercase text-xs tracking-widest transition-all hover:bg-[#003d7a]"
                                >
                                    Entrar
                                </button>
                                <button onClick={() => {setIsFirstAccess(true); setError('')}} className="text-xs font-bold text-slate-400 underline mt-4 block mx-auto">
                                    Ativar Primeiro Acesso
                                </button>
                            </div>
                        ) : (
                            <div className="space-y-3">
                                <h3 className="text-[#002e5d] font-bold uppercase text-xs">Primeiro Acesso</h3>
                                 <input 
                                    type="text" 
                                    placeholder="Login Autorizado" 
                                    className="w-full p-4 rounded-2xl bg-slate-100 border-none outline-none text-sm font-bold"
                                />
                                 <button 
                                    onClick={() => setError('Simulação: Contate o administrador.')}
                                    className="w-full bg-green-600 text-white py-4 rounded-2xl font-bold shadow-xl active:scale-95 uppercase text-xs tracking-widest transition-all"
                                >
                                    Ativar Conta
                                </button>
                                {error && <p className="text-xs text-red-500 font-bold">{error}</p>}
                                <button onClick={() => {setIsFirstAccess(false); setError('')}} className="text-xs font-bold text-slate-400 underline mt-4 block mx-auto">
                                    Voltar
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // 2. Componente de Dashboard
        const Dashboard = ({ members, attendance }) => {
            const orgData = [
                { name: 'ÉLD', total: 10, present: 5 },
                { name: 'SOC', total: 15, present: 8 },
                { name: 'RAP', total: 5, present: 2 },
                { name: 'MOÇ', total: 8, present: 4 },
                { name: 'PRI', total: 12, present: 9 },
            ];

            const historyData = [
                { date: '01', count: 45 },
                { date: '08', count: 52 },
                { date: '15', count: 48 },
                { date: '22', count: 60 },
            ];

            const totalPresent = (attendance.presents?.length || 0) + attendance.lideresCount + attendance.visitantesCount;
            const totalMembers = members.length;
            
            return (
                <div className="space-y-8 animate-in">
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div className="bg-white/90 backdrop-blur rounded-[28px] p-8 border-l-[12px] border-green-500 shadow-sm">
                            <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Presentes Hoje</p>
                            <p className="text-5xl font-black text-slate-800 leading-tight">{totalPresent}</p>
                        </div>
                        <div className="bg-white/90 backdrop-blur rounded-[28px] p-8 border-l-[12px] border-[#002e5d] shadow-sm">
                            <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Membros Ala</p>
                            <p className="text-5xl font-black text-slate-800 leading-tight">{totalMembers}</p>
                        </div>
                        <div className="bg-white/90 backdrop-blur rounded-[28px] p-8 border-l-[12px] border-orange-500 shadow-sm">
                            <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Resgate</p>
                            <p className="text-5xl font-black text-slate-800 leading-tight">{2}</p>
                        </div>
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div className="bg-white/90 backdrop-blur rounded-[28px] p-8 shadow-sm">
                             <h3 className="text-xs font-bold uppercase text-slate-400 mb-4">Frequência por Org</h3>
                            <div className="h-[220px] w-full">
                                <ResponsiveContainer width="100%" height="100%">
                                    <BarChart data={orgData} layout="vertical">
                                        <XAxis type="number" hide />
                                        <YAxis dataKey="name" type="category" width={40} tick={{fontSize: 10, fontWeight: 800}} />
                                        <Tooltip cursor={{fill: '#f1f5f9'}} />
                                        <Bar dataKey="present" fill="#002e5d" radius={[0, 8, 8, 0]} barSize={20} />
                                    </BarChart>
                                </ResponsiveContainer>
                            </div>
                        </div>
                        <div className="bg-white/90 backdrop-blur rounded-[28px] p-8 shadow-sm">
                             <h3 className="text-xs font-bold uppercase text-slate-400 mb-4">Histórico Mensal</h3>
                            <div className="h-[220px] w-full">
                                <ResponsiveContainer width="100%" height="100%">
                                    <LineChart data={historyData}>
                                        <XAxis dataKey="date" tick={{fontSize: 10}} />
                                        <Tooltip />
                                        <Line type="monotone" dataKey="count" stroke="#002e5d" strokeWidth={3} dot={{r: 4}} />
                                    </LineChart>
                                </ResponsiveContainer>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // 3. Componente de Frequência (Attendance)
        const Attendance = ({ members, attendance, user, onTogglePresence }) => {
            const [search, setSearch] = useState('');
            const [filterOrg, setFilterOrg] = useState('TODOS');
            const [showOptions, setShowOptions] = useState(false);

            const filteredMembers = useMemo(() => {
                return members.filter(m => {
                    const matchSearch = m.name.toLowerCase().includes(search.toLowerCase()) || m.familia.toLowerCase().includes(search.toLowerCase());
                    const matchOrg = filterOrg === 'TODOS' || m.org === filterOrg;
                    return matchSearch && matchOrg;
                }).sort((a, b) => {
                     if (a.familia === b.familia) return a.name.localeCompare(b.name);
                     return a.familia.localeCompare(b.familia);
                });
            }, [members, search, filterOrg]);

            let lastFamily = "";

            return (
                <div className="space-y-6 pb-20">
                    <div className="sticky top-0 z-10 bg-[#f1f5f9] pt-2 pb-4">
                        <div className="flex gap-3">
                            <div className="relative flex-1">
                                <Search className="absolute left-5 top-1/2 -translate-y-1/2 text-slate-300 w-5 h-5" />
                                <input 
                                    type="text" 
                                    value={search}
                                    onChange={(e) => setSearch(e.target.value)}
                                    placeholder="Buscar nome ou família..." 
                                    className="w-full pl-12 p-4 rounded-2xl bg-white border-none outline-none shadow-sm font-bold text-sm focus:ring-2 focus:ring-[#002e5d]"
                                />
                            </div>
                            <button 
                                onClick={() => setShowOptions(!showOptions)}
                                className={`w-14 h-14 rounded-2xl flex items-center justify-center shadow-sm border border-slate-100 transition-colors ${showOptions ? 'bg-[#002e5d] text-white' : 'bg-white text-[#002e5d]'}`}
                            >
                                <SlidersHorizontal className="w-5 h-5" />
                            </button>
                        </div>

                        {showOptions && (
                            <div className="mt-4 space-y-4 p-6 bg-white rounded-[32px] border shadow-sm animate-in slide-in-from-top-4">
                                <div className="space-y-2">
                                     <p className="text-[10px] font-black text-slate-400 uppercase ml-2">Filtros de Organização</p>
                                     <div className="flex overflow-x-auto gap-2 no-scrollbar py-2">
                                        {['TODOS', 'Quórum de Élderes', 'Sociedade de Socorro', 'Moças', 'Rapazes', 'Primária'].map(org => (
                                            <button 
                                                key={org}
                                                onClick={() => setFilterOrg(org)}
                                                className={`px-4 py-2 rounded-xl text-[10px] font-black uppercase whitespace-nowrap transition-all border ${filterOrg === org ? 'bg-[#002e5d] text-white border-[#002e5d]' : 'bg-slate-50 text-slate-500 border-slate-100'}`}
                                            >
                                                {org}
                                            </button>
                                        ))}
                                     </div>
                                </div>
                                {user.role === 'admin' && (
                                     <div className="grid grid-cols-2 gap-3 pt-2 border-t border-slate-50">
                                        <div className="bg-slate-50 p-3 rounded-2xl flex justify-between items-center">
                                            <span className="text-[10px] font-bold text-slate-500 uppercase">Líderes</span>
                                            <span className="font-black text-[#002e5d]">{attendance.lideresCount}</span>
                                        </div>
                                        <div className="bg-slate-50 p-3 rounded-2xl flex justify-between items-center">
                                            <span className="text-[10px] font-bold text-slate-500 uppercase">Visitantes</span>
                                            <span className="font-black text-[#002e5d]">{attendance.visitantesCount}</span>
                                        </div>
                                     </div>
                                )}
                            </div>
                        )}
                    </div>

                    <div className="space-y-2">
                        {filteredMembers.map(m => {
                            const isPresent = attendance.presents.includes(m.id);
                            const showHeader = m.familia !== lastFamily && !search;
                            if(showHeader) lastFamily = m.familia;

                            return (
                                <div key={m.id}>
                                    {showHeader && (
                                        <div className="bg-[#f8fafc] px-4 py-2 rounded-xl text-[10px] font-black text-slate-500 uppercase border border-slate-200 mb-2 mt-4">
                                            Família {m.familia}
                                        </div>
                                    )}
                                    <div 
                                        onClick={() => user.role === 'admin' && onTogglePresence(m.id)}
                                        className={`group p-5 flex items-center gap-4 rounded-[28px] border border-white/50 shadow-sm transition-all cursor-pointer ${isPresent ? 'bg-[#ecfdf5] border-l-[8px] border-l-teal-500' : 'bg-white border-l-[8px] border-l-slate-100 hover:bg-slate-50'}`}
                                    >
                                        <div className={`w-7 h-7 rounded-[10px] border-[2px] flex items-center justify-center transition-all ${isPresent ? 'bg-teal-600 border-teal-600 text-white' : 'border-slate-300 group-hover:border-slate-400'}`}>
                                            {isPresent && <Check size={14} strokeWidth={4} />}
                                        </div>
                                        <div className="flex-1 min-w-0">
                                            <h4 className={`font-bold text-sm truncate ${isPresent ? 'text-teal-900' : 'text-slate-800'}`}>{m.name}</h4>
                                            <p className="text-[9px] font-black text-slate-400 uppercase tracking-widest">{m.org}</p>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                        {filteredMembers.length === 0 && (
                            <div className="text-center py-10 opacity-50">
                                <p className="text-sm font-bold">Nenhum membro encontrado.</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // 4. Componente Principal (App) e Lógica de Layout
        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('dashboard');
            const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
            
            // Estados de Dados
            const [members] = useState(MOCK_MEMBERS);
            const [attendance, setAttendance] = useState({
                presents: [],
                lideresCount: 0,
                visitantesCount: 0
            });

            useEffect(() => {
                const stored = localStorage.getItem('user_data');
                if (stored) {
                    setUser(JSON.parse(stored));
                }
            }, []);

            const handleLogin = (userData) => {
                localStorage.setItem('user_data', JSON.stringify(userData));
                setUser(userData);
            };

            const handleLogout = () => {
                localStorage.removeItem('user_data');
                setUser(null);
                setView('dashboard');
            };

            const togglePresence = (id) => {
                setAttendance(prev => {
                    const isPresent = prev.presents.includes(id);
                    return {
                        ...prev,
                        presents: isPresent 
                            ? prev.presents.filter(pid => pid !== id)
                            : [...prev.presents, id]
                    };
                });
            };

            // --- CORREÇÃO DO BUG ---
            // Se não houver usuário logado, retorna o componente de Login.
            // Isso impede que qualquer parte do layout (navbar, menu) seja renderizada.
            if (!user) {
                return <Login onLogin={handleLogin} />;
            }

            // Componentes auxiliares de navegação
            const NavItem = ({ id, icon: Icon, label, mobile = false }) => (
                <button 
                    onClick={() => { setView(id); if(mobile) setIsMobileMenuOpen(false); }}
                    className={`
                        flex items-center gap-4 p-4 rounded-2xl text-sm font-bold transition-all w-full
                        ${view === id 
                            ? 'bg-slate-50 text-[#002e5d] border-r-4 border-[#002e5d]' 
                            : 'text-slate-400 hover:bg-slate-50'}
                        ${mobile ? 'justify-start' : ''}
                    `}
                >
                    <Icon className={`w-5 h-5 ${mobile ? '' : 'text-center'}`} />
                    <span>{label}</span>
                </button>
            );

            const MobileNavItem = ({ id, icon: Icon }) => (
                <button 
                    onClick={() => setView(id)}
                    className={`flex flex-col items-center gap-1 transition-all ${view === id ? 'text-[#002e5d] scale-110' : 'text-slate-300'}`}
                >
                    <Icon className="w-6 h-6" />
                </button>
            );

            return (
                <div className="flex h-screen overflow-hidden bg-[#f1f5f9]">
                    
                    {/* Desktop Sidebar */}
                    <aside className="hidden lg:flex w-[300px] bg-white flex-col border-r border-slate-200 p-8">
                        <div className="flex items-center gap-3 mb-12 px-2">
                            <div className="w-10 h-10 bg-[#002e5d] rounded-2xl flex items-center justify-center text-white shadow-lg">
                                <Church size={20} />
                            </div>
                            <h1 className="font-black text-xs uppercase text-[#002e5d] leading-none tracking-tighter">Ala<br/>Ribeirão Preto 1</h1>
                        </div>
                        
                        <nav className="flex-1 space-y-2">
                            <NavItem id="dashboard" icon={LayoutDashboard} label="Dashboard" />
                            <NavItem id="attendance" icon={ClipboardList} label="Registrar Frequência" />
                            <NavItem id="analysis" icon={HeartHandshake} label="Resgate" />
                            <NavItem id="reports" icon={FileText} label="Relatórios" />
                            <NavItem id="add" icon={PlusCircle} label="Novo Membro" />
                        </nav>

                        <div className="bg-slate-50 p-6 rounded-[32px] mt-auto">
                            <p className="font-black text-[10px] uppercase text-slate-700 truncate tracking-tighter italic">{user.name}</p>
                            <button onClick={handleLogout} className="flex items-center gap-2 text-[9px] font-black text-red-400 mt-2 hover:underline uppercase tracking-widest text-left">
                                <LogOut size={10} /> Sair
                            </button>
                        </div>
                    </aside>

                    {/* Main Content */}
                    <main className="flex-1 flex flex-col h-full overflow-hidden relative">
                        
                        {/* Mobile Header */}
                        <header className="lg:hidden p-6 flex justify-between items-center bg-white border-b border-slate-100 shrink-0">
                            <h2 className="font-black text-[#002e5d] text-lg italic uppercase tracking-tighter">
                                {view === 'dashboard' ? 'Painel Geral' : 
                                 view === 'attendance' ? 'Frequência' : 
                                 view === 'analysis' ? 'Resgate' : 'Ala'}
                            </h2>
                            <button onClick={() => setIsMobileMenuOpen(true)} className="w-10 h-10 rounded-xl bg-slate-50 text-[#002e5d] flex items-center justify-center shadow-sm">
                                <Menu size={20} />
                            </button>
                        </header>

                        {/* Scrollable Area */}
                        <div className="flex-1 overflow-y-auto w-full">
                            <div className="w-full max-w-[1100px] mx-auto p-5 pb-32 lg:p-10">
                                {view === 'dashboard' && <Dashboard members={members} attendance={attendance} />}
                                {view === 'attendance' && <Attendance members={members} attendance={attendance} user={user} onTogglePresence={togglePresence} />}
                                {view === 'analysis' && <div className="text-center text-slate-400 font-bold mt-20">Módulo de Resgate (Em desenvolvimento)</div>}
                                {view === 'reports' && <div className="text-center text-slate-400 font-bold mt-20">Relatórios (Em desenvolvimento)</div>}
                                {view === 'add' && <div className="text-center text-slate-400 font-bold mt-20">Cadastro (Em desenvolvimento)</div>}
                            </div>
                        </div>

                        {/* Mobile Bottom Navigation */}
                        <div className="lg:hidden absolute bottom-6 left-6 right-6 h-20 bg-white/90 backdrop-blur rounded-[28px] flex justify-around items-center px-4 z-50 border-2 border-white shadow-2xl">
                            <MobileNavItem id="dashboard" icon={LayoutDashboard} />
                            <MobileNavItem id="attendance" icon={ClipboardList} />
                            <MobileNavItem id="analysis" icon={HeartHandshake} />
                            <MobileNavItem id="reports" icon={FileText} />
                            <MobileNavItem id="add" icon={PlusCircle} />
                        </div>
                    </main>

                    {/* Mobile Drawer Overlay */}
                    {isMobileMenuOpen && (
                        <div className="fixed inset-0 z-[60]">
                            <div className="absolute inset-0 bg-black/20 backdrop-blur-sm" onClick={() => setIsMobileMenuOpen(false)}></div>
                            <div className="absolute top-0 right-0 h-full w-64 bg-white shadow-2xl flex flex-col animate-in slide-in-from-right duration-300">
                                <div className="p-6 bg-[#002e5d] text-white">
                                    <p className="font-bold truncate text-sm">{user.name}</p>
                                    <p className="text-[9px] opacity-70 uppercase tracking-widest font-black">{user.role === 'admin' ? 'Administrador' : 'Secretário'}</p>
                                </div>
                                <div className="p-4 space-y-2">
                                     <button onClick={handleLogout} className="w-full flex items-center gap-3 p-4 rounded-2xl text-red-500 hover:bg-red-50 font-bold text-xs uppercase">
                                        <LogOut size={16} /> Sair do Sistema
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
